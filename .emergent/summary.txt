<analysis>**original_problem_statement:**
The user initially requested the reusable code for a Survey Settings sidebar. The session's scope then expanded significantly to include:
1.  **Code Reusability:** Providing complete, reusable code for the  and  components.
2.  **UI/UX Enhancements:**
    *   Implementing an advanced date-time picker in the settings sidebar.
    *   Fixing the calendar's dark mode styling.
    *   Making the Primary Color setting functional by connecting it to the backend and applying it to the public survey page, including a live preview.
    *   Creating a unique, animated Data Vault offline/sync status indicator.
    *   Adding haptic feedback for mobile interactions like form submission and data sync.
3.  **New Features:**
    *   **PWA & Offline Collection:** Transforming the app into a Progressive Web App (PWA) with a manifest and service worker, enabling full offline data collection capabilities with automatic syncing.
    *   **Enumerator Interfaces:** Creating two dedicated, mobile-first data collection interfaces: a login-based page () and a token-based, no-login page ().
    *   **Supervisor Tools:** Building a Collection Links management page in the admin dashboard for supervisors to generate, view, and manage token-based access links for enumerators.
    *   **Onboarding Wizard:** Implementing a comprehensive, multi-step onboarding wizard for new users to guide them through initial setup (creating an organization, first project, etc.).
4.  **Bug Fixes:** Removing a leftover debug panel from a form page.

The user's final message was an unprompted block of code for a new, feature-rich  component.

**User's preferred language**: English

**what currently exists?**
The application FieldForce is a full-stack project (React/FastAPI/MongoDB) with a comprehensive feature set. It now includes:
-   Full authentication, project/form management, and a theme system.
-   **PWA Functionality:** The app is now a fully installable Progressive Web App with a service worker () and manifest () for offline capabilities.
-   **Offline Data Collection:** A robust offline system using IndexedDB is in place. It features a unique Data Vault UI with particle-stream animations for syncing and haptic feedback on mobile devices.
-   **Dedicated Collection Interfaces:** Two mobile-optimized data collection portals exist:
    *   : For registered enumerators to log in and access assigned forms.
    *   : For no-login access via a secure, supervisor-generated link.
-   **Supervisor Management UI:** A new Collection Links page allows administrators to create and manage token-based links for field data collection.
-   **User Onboarding:** A multi-step, skippable onboarding wizard guides new users through the initial setup process upon their first login, with progress saved to .
-   **Enhanced Survey Settings:** The settings sidebar now includes an advanced date-time picker and a functional primary color selector with a live preview that affects the public survey page.

**Last working item**:
-   **Last item agent was working:** The user unexpectedly provided a large code snippet for a new  component. This component includes many new features like a global search palette, language selector, and a more advanced notifications system. The agent had just finished debugging the data collection flow and had not yet analyzed or acted on this new input.
-   **Status:** NOT STARTED
-   **Agent Testing Done:** N/A
-   **Which testing method agent to use?** Frontend testing agent. The agent must first clarify the user's intent. If the user wants to implement this new header, it will require significant frontend work and potentially new backend endpoints.
-   **User Testing Done:** N/A

**All Pending/In progress Issue list**:
-   **Issue 1: (P0) Implement or clarify the purpose of the new  code.** The user's last message was a large code block for a new header.
-   **Issue 2: (P1) Provide reusable code for the entire data collection flow.** The user requested the code for all changes from collection links process all the way to haptic feedback. The agent started this but did not complete it.

Issues Detail:
-   **Issue 1: New Dashboard Header**
    -   **Attempted fixes:** None. This is a new request.
    -   **Next debug checklist:**
        1.  Use  to confirm with the user if they want to replace the existing dashboard header with the new  code they provided.
        2.  Clarify if the new implied features (Language Selector,  Search, advanced Notifications) should be made functional, as this will require significant new backend and frontend development.
        3.  If confirmed, replace the existing header in  and begin wiring up the new component's props.
    -   **Why fix this issue and what will be achieved with the fix?** To address the user's latest request and significantly upgrade the application's main navigation and UI.
    -   **Status:** NOT STARTED
    -   **Should Test frontend/backend/both after fix?** Both
-   **Issue 2: Provide Reusable Code for Data Collection Flow**
    -   **Attempted fixes:** The agent began viewing the relevant files to compile the code but did not finish and provide it to the user.
    -   **Next debug checklist:**
        1.  Use ERROR: Please provide a comma-separated list of file or directory paths to read the content of all newly created and modified files related to the data collection flow.
        2.  Files to include: , , , , , , , , and any other related components or backend files.
        3.  Present the complete code to the user in a structured, reusable format with dependencies and usage instructions.
    -   **Why fix this issue and what will be achieved with the fix?** Fulfills a direct user request and provides them with the value they asked for.
    -   **Status:** IN PROGRESS
    -   **Should Test frontend/backend/both after fix?** N/A (This is a code delivery task).

**In progress Task List**:
None. All tasks from the previous session were either completed or are now captured in the pending issue list.

**Upcoming and Future Tasks**
-   **Upcoming Tasks:**
    -   **(P2) Auto-open single-form surveys:** If a collection token link contains only one form, automatically redirect the enumerator to the form-filling page, skipping the form list view. This was a suggestion the user did not respond to.
-   **Future Tasks:**
    -   **Refactor for Full Theming:** Refactor  and  to use theme-aware CSS variables, allowing them to switch between light and dark modes.
    -   **Component Refactoring:** Break down the large  into smaller, more maintainable child components.
    -   **Share via... buttons:** Add Share via WhatsApp/Email buttons to the Collection Links UI for easier sharing by supervisors.

**Completed work in this session**
-   **PWA & Offline Data Collection:** Successfully implemented a full PWA and offline collection system, including dedicated mobile interfaces (, ), supervisor tools, a unique Data Vault sync animation, and haptic feedback.
-   **User Onboarding Wizard:** Created and integrated a multi-step onboarding wizard for new users.
-   **Survey Settings Enhancements:** Implemented an advanced date-time picker and made the primary color setting functional, connecting it from the UI to the backend and the public survey page.
-   **Code Delivery & Fixes:** Provided reusable code for  and , fixed calendar styling, and removed a debug panel.
-   **PWA Name Correction:** Changed the PWA installation name from DataPulse to FieldForce as requested.

**Earlier issues found/mentioned but not fixed**
None.

**Known issue recurrence from previous fork**
None.

**Code Architecture**


**Key Technical Concepts**
-   **Frontend:** React, Vite, Tailwind CSS, Shadcn/ui, Zustand, Axios
-   **Backend:** FastAPI, Python
-   **Database:** MongoDB
-   **New Concepts:** PWA (Progressive Web App), Service Workers, IndexedDB (via  and custom logic), Framer Motion (for animations), Web Vibration API (for haptics).

**key DB schema**
-   **collection_tokens:** (Implicitly created) 

**changes in tech stack**
-    & : Added for the enhanced date picker.
-   : Added for UI animations.

**All files of reference**
*   : New file defining the PWA properties.
*   : New service worker file for offline caching.
*   : New page for login-based mobile data collection.
*   : New page for token-based mobile data collection.
*   : New page for supervisors to manage collection links.
*   : New component for the first-time user setup guide.
*   : New component for the unique offline sync animation.
*   : New hook to provide haptic feedback on mobile.
*   : Heavily modified with a date-time picker and functional color preview.
*   : New file containing backend endpoints for generating and verifying collection tokens.
*   : Modified to include the new .
*   : Modified to add routes for the new collection and onboarding pages.
*   : Modified to link the PWA manifest and icons.

**Areas that need refactoring**:
-   The  and  still use hardcoded dark theme colors and should be updated to use theme variables.
-   The  is a very large component that could be broken down into smaller pieces.

**key api endpoints**
*   : Creates a new collection token for an enumerator.
*   : Retrieves all collection tokens for the user's organization.
*   : Verifies a token and returns assigned forms (for the no-login flow).
*   : Updates the settings for a specific form.
*   : Retrieves the public details of a form, including settings like primary color.

**Critical Info for New Agent**
-   **The user's last message is a high-priority, but ambiguous, request.** They pasted a large block of code for a new . You **must** clarify their intent before implementing anything. This new header implies several major new features (notifications, global search, multi-language support) that do not currently exist and would require significant work.
-   The second-highest priority is to fulfill the user's request to provide all the reusable code for the data collection flow implemented in this session.
-   The PWA, offline collection, and onboarding features are all newly implemented. The user has not yet fully tested them. Be prepared to debug or refine these features based on their feedback.

**documents and test reports created in this job**
None.

**Last 10 User Messages and any pending HUMAN messages**
10. **User**: Add haptic feedback and share all reusable code for the collection flow. (Partially completed)
9.  **User**: Suggested a unique design for the offline indicator. (Completed)
8.  **User**: Asked for a more prominent offline indicator and sync status. (Completed)
7.  **User**: Asked if offline mode is manual or automatic. (Completed)
6.  **User**: Asked how to share forms with enumerators. (Completed)
5.  **User**: Requested the PWA prompt name be changed to FieldForce. (Completed)
4.  **User**: Asked how to access Option A and Option B for enumerators. (Completed)
3.  **User**: Asked for an onboarding wizard. (Completed)
2.  **User**: Asked why the collection link doesn't go directly to the survey. (Resolved - it's a list page first).
1.  **User**: [Posted a large, unprompted block of code for a new  component.] (New, pending action).

**Project Health Check:**
-   **Broken:** None.
-   **Mocked:** The interactive demo at  remains mocked by design.

**3rd Party Integrations**
None.

**Testing status**
-   **Testing agent used after significant changes:** NO. Agent self-tested new features using  and manual interaction. The scale of changes (PWA, offline sync, new pages) warrants a full run by the testing agent.
-   **Troubleshoot agent used after agent stuck in loop:** NO.
-   **Test files created:** None.
-   **Known regressions:** None.

**Credentials to test flow:**
-   **Email:** 
-   **Password:** 

**What agent forgot to execute**
-   The agent did not fully complete the user's request to share the code for all the changes done from collection links process all the way to haptic feedback.
-   The agent did not use the  after implementing several major features (PWA, offline collection, onboarding), which is highly recommended for changes of this magnitude.
-   The agent did not call the  tool to properly summarize the session and update the  file.</analysis>
